<?php
include_once __DIR__ . '/UserModel.php';

// Obtener el nickName del usuario por la sesi칩n
$nickName = isset($_POST['usuario']) ? $_POST['usuario'] : '';
$password = isset($_POST['password']) ? $_POST['password'] : '';

// Crear una instancia de UserManager
$userManager = new UserManager();

// Verificar si se envi칩 el formulario
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    try {
        // Obtener nuevos datos del formulario
        $newNickName = isset($_POST['new_nickName']) ? $_POST['new_nickName'] : '';
        $newPassword = isset($_POST['new_password']) ? $_POST['new_password'] : '';

        // Crear una instancia de User con los nuevos datos
        $updatedUser = new User($newNickName, $newPassword, $password);

        // Actualizar el usuario
        $userManager->updateUser($updatedUser, $nickName);

        // Redirigir a la p치gina principal u otro destino
        header("Location: listaTareas_View.phtml");
        exit();
    } catch (Exception $e) {
        die("ERROR: " . $e->getMessage());
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Perfil</title>
    <style>
        h1 {
            text-align: center;
        }
        form {
            width: 50%;
            margin: auto;
        }
        label {
            display: block;
            margin-bottom: 10px;
        }
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Actualizar Perfil</h1>

    <form action="" method="post">
        <label for="new_nickName">Nuevo Nombre de Usuario:</label>
        <input type="text" name="new_nickName" value="<?= htmlspecialchars($user['nickName'] ?? ''); ?>">

        <label for="new_password">Nueva Contrase침a:</label>
        <input type="password" name="new_password">

        <button type="submit">Guardar Cambios</button>
    </form>
</body>
</html>